version: "3.9"

services:
    server:
        image: nginx:alpine
        container_name: server_interescolares
        restart: unless-stopped
        ports:
            - 82:80
        networks:
            - app-network
        volumes:
            - ./:/var/www
            - ./nginx/conf.d/:/etc/nginx/conf.d/

    db:
        image: postgres
        container_name: database_interescolares
        ports:
            - 8080:8080
        env_file:
            - .env
        environment:
            POSTGRES_DB: $DB_DATABASE
            POSTGRES_PASSWORD: $DB_PASSWORD
            POSTGRES_USER: $DB_USERNAME
        networks:
            - app-network
        volumes:
            - ./dbdata:/var/lib/postgresql/data
    #pgadmin:
    #    image: dpage/pgadmin4
    #    container_name: pgadmin4
    #    ports:
    #        - 5050:8080
    #    environment:
    #        PGADMIN_DEFAULT_EMAIL: admin@admin.com
    #        PGADMIN_DEFAULT_PASSWORD: a1b1c1d1..
    #    networks:
    #        - app-network
    #    volumes:
    #        - ./pgadmin:/var/lib/pgadmin
    app:
        build: .
        container_name: app_interescolares
        networks:
            - app-network
        volumes:
            - ./:/var/www
        working_dir: /var/www
        command: sh /var/www/laravel.sh
        depends_on:
            - db

    node:
        image: node:16-alpine
        container_name: node_interescolares
        working_dir: /root
        volumes:
            - ./:/root
        command: sh /root/node_start.sh
        depends_on:
            - app

networks:
    app-network:
        driver: bridge

volumes:
    dbdata:
